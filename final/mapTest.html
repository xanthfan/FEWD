<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { width:100% ; height: 100% }
    </style>

    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAMLGETiyd_eYo65xHXPeGagUuroCNkbzM&sensor=false">
    </script>
    
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js">
    </script>

    <script src="data/map.jsonp"></script>

    <script type="text/javascript">

    var mapLatLng, happyLatLng, sadLatLng;

    function initialize() {
      var mapOptions = {
        center: mapLatLng,
        zoom: 11,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };

      var map = new google.maps.Map(document.getElementById("map-canvas"),
          mapOptions);

       var marker = new google.maps.Marker({
          position: happyLatLng,
          map: map,
          draggable:true,
          title:"Happy!",
          icon: "images/happy.png"
        });

        var marker2 = new google.maps.Marker({
          position: sadLatLng,
          map: map,
          draggable:true,
          title:"Sad.",
          icon: "images/sad.png"
        });

        google.maps.event.addListener(map,"dragstart",function(evt){
            console.log("Dragging the map!")       
        })

        google.maps.event.addListener(map,"dragend",function(evt){
            console.log("Stopped dragging the map.");
            sessionStorage.mapLat = map.center.lb;
            sessionStorage.mapLng = map.center.mb;         
        })

        google.maps.event.addListener(marker,"dragend",function(evt){
            sessionStorage.happyLat = marker.position.lb;
            sessionStorage.happyLng = marker.position.mb;         
        })

        google.maps.event.addListener(marker2,"dragend",function(evt){
            sessionStorage.sadLat = marker2.position.lb;
            sessionStorage.sadLng = marker2.position.mb;         
        })
    }

    if (!sessionStorage.mapLat){
      mapLatLng = new google.maps.LatLng(jsonstr[0].HK.x, jsonstr[0].HK.y);
    } else {
      mapLatLng = new google.maps.LatLng(sessionStorage.mapLat, sessionStorage.mapLng);
    }

    if (!sessionStorage.happyLat){
      happyLatLng = new google.maps.LatLng(jsonstr[1].happy.x, jsonstr[1].happy.y);
    } else {
      happyLatLng = new google.maps.LatLng(sessionStorage.happyLat, sessionStorage.happyLng);
    }

   if (!sessionStorage.sadLat){
    sadLatLng = new google.maps.LatLng(jsonstr[2].sad.x, jsonstr[2].sad.y);
    } else {
      sadLatLng = new google.maps.LatLng(sessionStorage.sadLat, sessionStorage.sadLng);
    }

    google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
    <div id="map-canvas">a</div>
    <button id="save">Save Locations</button>
  </body>
</html>